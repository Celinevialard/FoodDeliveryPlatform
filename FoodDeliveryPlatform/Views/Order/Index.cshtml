@using DTO;
@model OrderIndexVM

@{
  ViewData["Title"] = "Commandes";
}

<h1>Commandes</h1>

@if (Model.OrdersDelivery != null && Model.OrdersDelivery.Any())
{
  <h2>Liste de livraison</h2>
  <table class="table">
    <thead>
      <tr>
        <th>
          Nom du client
        </th>
        <th>
          Localité
        </th>
        <th>
          Addresse
        </th>
        <th>
          Date
        </th>
        <th>
          Total
        </th>
        <th>
          Statut
        </th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      @foreach (var item in Model.OrdersDelivery)
      {
        <tr>
          <td>
            @Html.DisplayFor(modelItem => item.CustomerName)
          </td>
          <td>
            @Html.DisplayFor(modelItem => item.CustomerLocation)
          </td>
          <td>
            @Html.DisplayFor(modelItem => item.CustomerAddress)
          </td>
          <td>
            @Html.DisplayFor(modelItem => item.OrderDate)
          </td>
          <td>
            @Html.DisplayFor(modelItem => item.TotalAmount)
          </td>
          <td>
            @Html.DisplayFor(modelItem => item.Status)
          </td>
          <td>

            @Html.ActionLink("Delivered", "Edit", new { id = item.OrderId }) |
            @Html.ActionLink("Details", "Details", new { id = item.OrderId })
          </td>
        </tr>
      }
    </tbody>
  </table>
}
@if (Model.OrdersCustomer != null && Model.OrdersCustomer.Any())
{
  <h2>Historique de commande</h2>
  <table class="table">
    <thead>
      <tr>
        <th>
          Date
        </th>
        <th>
          Total
        </th>
        <th>
          Statut
        </th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      @foreach (var item in Model.OrdersCustomer)
      {
        <tr>
          <td>
            @Html.DisplayFor(modelItem => item.OrderDate)
          </td>
          <td>
            @Html.DisplayFor(modelItem => item.TotalAmount)
          </td>
          <td>
            @Html.DisplayFor(modelItem => item.Status)
          </td>
          <td>
            @if (DateTime.Now.AddHours(3) <= item.OrderDate && item.Status == OrderStatusEnum.Delivering)
            {
              <span>@Html.ActionLink("Cancel", "Cancel", new { id = item.OrderId }) |</span>
            }

            @Html.ActionLink("Details", "Details", new { id = item.OrderId })
          </td>
        </tr>
      }
    </tbody>
  </table>
}
@if ((Model.OrdersCustomer == null || !Model.OrdersCustomer.Any()) && (Model.OrdersDelivery == null || !Model.OrdersDelivery.Any()))
{
  <p>Pas de commande disponible</p>
}
